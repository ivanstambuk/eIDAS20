# VCQ Requirements: Presentation Intermediary (VEND-PIF-*)
# 
# These requirements apply specifically to Presentation Intermediaries (PIF).
# PIFs receive and forward wallet presentations but do NOT perform cryptographic
# verification - they act as a conduit between wallets and RPs.
#
# Schema Version: 1
# Created: 2026-01-22
# Decision: DEC-222

schemaVersion: 1

requirements:
  # ============================================================================
  # TRANSPARENCY
  # ============================================================================
  
  - id: VEND-PIF-001
    category: transparency
    requirement: "Display both intermediary and RP identity before requesting attestations"
    explanation: |
      When a PIF requests attestations from a wallet user, the wallet must display 
      both the PIF's identity (as the direct requester) and the identity of the 
      ultimate Relying Party on whose behalf the PIF is acting. This ensures 
      informed consent.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_07"
    legalText: |
      When an intermediary requests attestations from a wallet unit, the wallet 
      unit shall display both the identity of the intermediary and the identity 
      of the relying party on whose behalf the intermediary is acting.
    applicability:
      - pif
    deadline: "2027-11-21"
    criticality: high
  
  - id: VEND-PIF-002
    category: transparency
    requirement: "Ensure RP's intended data requests are accurately communicated to wallet"
    explanation: |
      The PIF must not modify, expand, or alter the RP's registered data request 
      when forwarding to wallets. Only the attributes registered by the RP may 
      be requested.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_11"
    applicability:
      - pif
    linkedRCA:
      - RP-REG-003
    deadline: "2027-11-21"
    criticality: high
  
  # ============================================================================
  # TECHNICAL
  # ============================================================================
  
  - id: VEND-PIF-003
    category: technical
    requirement: "Forward presentation requests without modification of requested attributes"
    explanation: |
      The PIF must accurately relay the RP's attribute request to the wallet 
      without adding, removing, or modifying the requested attributes. The 
      request must match what the RP registered with supervisory authorities.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_11"
    applicability:
      - pif
    deadline: "2027-11-21"
    criticality: high
  
  - id: VEND-PIF-004
    category: technical
    requirement: "Forward wallet presentations to RP without modification"
    explanation: |
      The PIF must relay the wallet's presentation to the RP exactly as received, 
      without altering, extracting, or processing the credential data. The 
      presentation integrity must be preserved.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_13"
    applicability:
      - pif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-PIF-005
    category: technical
    requirement: "Support both remote and proximity presentation protocols"
    explanation: |
      If the RP requires both remote and proximity (offline) presentation 
      scenarios, the PIF must support the relevant ISO/IEC 18013-5 and 
      ISO/IEC TS 18013-7 protocols.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 5"
      paragraph: "1-2"
    annexReference: |
      Annex to 2024/2982:
      - ISO/IEC 18013-5:2021 (proximity)
      - ISO/IEC TS 18013-7:2024 (remote)
    applicability:
      - pif
    linkedRCA:
      - RP-TEC-002
    deadline: "2027-11-21"
    criticality: medium
  
  # ============================================================================
  # SECURITY
  # ============================================================================
  
  - id: VEND-PIF-006
    category: security
    requirement: "Ensure secure channel for transmission to RP"
    explanation: |
      The PIF must establish and maintain a secure, encrypted channel when 
      forwarding wallet presentations to the RP. Transport layer security 
      (TLS 1.3 or equivalent) is required.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_13"
    applicability:
      - pif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-PIF-007
    category: security
    requirement: "Implement measures to prevent replay attacks"
    explanation: |
      The PIF must implement mechanisms to detect and prevent replay of 
      previously received wallet presentations. Nonce-based challenge-response 
      and session binding are typical approaches.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_14"
    applicability:
      - pif
    deadline: "2027-11-21"
    criticality: high
  
  # ============================================================================
  # PRIVACY
  # ============================================================================
  
  - id: VEND-PIF-008
    category: privacy
    requirement: "Do not extract or log individual attribute values from presentations"
    explanation: |
      Beyond the no-storage mandate, PIFs must not extract, log, or analyze 
      individual attribute values from wallet presentations. The presentation 
      should be treated as an opaque payload for forwarding.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "10"
    applicability:
      - pif
    criticality: critical
    deadline: "2027-11-21"
  
  - id: VEND-PIF-009
    category: privacy
    requirement: "Do not correlate or link user presentations across different RPs"
    explanation: |
      PIFs serving multiple RPs must not correlate wallet user activity across 
      different RP interactions. Each RP relationship must be treated 
      independently to preserve user unlinkability.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "16(a)"
    applicability:
      - pif
    linkedRCA:
      - RP-PRV-003
    deadline: "2027-11-21"
    criticality: critical
