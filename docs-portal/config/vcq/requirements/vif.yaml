# VCQ Requirements: Verification Intermediary (VEND-VIF-*)
# 
# These requirements apply specifically to Verification Intermediaries (VIF).
# VIFs perform cryptographic verification of attestations on behalf of RPs,
# including signature validation, revocation checking, and trust anchor management.
#
# Schema Version: 1
# Created: 2026-01-22
# Decision: DEC-222

schemaVersion: 1

requirements:
  # ============================================================================
  # TECHNICAL - Trust Anchor Management
  # ============================================================================
  
  - id: VEND-VIF-001
    category: technical
    requirement: "Maintain up-to-date Trusted Lists for PID Providers"
    explanation: |
      VIFs must maintain current copies of the Trusted Lists containing PID 
      Provider trust anchors (public keys/certificates). These lists are 
      published by Member States and the Commission and must be refreshed 
      regularly to capture additions, modifications, and revocations.
    arfReference:
      topic: "Topic 1"
      hlr: "OIA_12"
    applicability:
      - vif
    linkedRCA:
      - RP-TEC-001
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-002
    category: technical
    requirement: "Maintain up-to-date Trusted Lists for Attestation Providers"
    explanation: |
      VIFs must maintain current copies of Trusted Lists for qualified and 
      non-qualified electronic attestation of attributes (QEAA/EAA) providers. 
      These trust anchors are essential for validating attestation signatures.
    arfReference:
      topic: "Topic 1"
      hlr: "OIA_13"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-003
    category: technical
    requirement: "Obtain trust anchors only from official Trusted List sources"
    explanation: |
      Trust anchors for verification must be obtained exclusively from official 
      EU and Member State Trusted Lists, not from third-party aggregators or 
      unofficial sources. This ensures the authenticity of verification keys.
    arfReference:
      topic: "Topic 1"
      hlr: "OIA_14"
    legalBasis:
      regulation: "2014/910"
      article: "Article 32"
      paragraph: ""
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  # ============================================================================
  # VERIFICATION
  # ============================================================================
  
  - id: VEND-VIF-004
    category: verification
    requirement: "Validate attestation signatures using official trust anchors"
    explanation: |
      The VIF must verify the cryptographic signatures on attestations and PIDs 
      using the public keys from official Trusted Lists. Invalid or untrusted 
      signatures must result in rejection.
    arfReference:
      topic: "Topic 6"
      hlr: "RPA_05"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-005
    category: verification
    requirement: "Verify attestation revocation status before acceptance"
    explanation: |
      Before accepting a presentation as valid, the VIF must check the revocation 
      status of the attestation. This may involve checking validity status lists, 
      OCSP responses, or other revocation mechanisms as specified by the issuer.
    arfReference:
      topic: "Topic 8"
      hlr: "VCR_13"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-006
    category: verification
    requirement: "Verify the wallet unit's device binding"
    explanation: |
      The VIF must verify that the presentation is bound to the wallet unit's 
      secure cryptographic device (WSCD), confirming that the presenter controls 
      the private key associated with the attestations.
    arfReference:
      topic: "Topic 6"
      hlr: "RPA_07"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-007
    category: verification
    requirement: "Verify presentation freshness (anti-replay)"
    explanation: |
      The VIF must verify that presentations are fresh and not replayed by 
      checking nonces, timestamps, or session binding. Stale or replayed 
      presentations must be rejected.
    arfReference:
      topic: "Topic 6"
      hlr: "RPA_08"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: high
  
  # ============================================================================
  # SECURITY - Key Management
  # ============================================================================
  
  - id: VEND-VIF-008
    category: security
    requirement: "Implement secure key management for verification operations"
    explanation: |
      The VIF must implement secure storage and handling of any cryptographic 
      material used in verification operations. Keys must be protected against 
      unauthorized access, modification, and extraction.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 3"
      paragraph: ""
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-009
    category: security
    requirement: "Protect verification results integrity"
    explanation: |
      The verification result communicated to the RP must be protected against 
      tampering. The RP must be able to trust that the VIF's verification 
      outcome is authentic and unmodified.
    arfReference:
      topic: "Topic 45"
      hlr: "RPI_15"
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-010
    category: security
    requirement: "Maintain audit logs of verification operations"
    explanation: |
      The VIF should maintain logs of verification operations including 
      verification timestamps, outcomes, and any errors. These logs support 
      dispute resolution and compliance auditing while respecting privacy 
      (no attestation content should be logged).
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: medium
    notes: |
      Logs must not contain attestation content (due to no-storage mandate) 
      but may contain verification metadata (pass/fail, timestamp, error codes).
  
  # ============================================================================
  # INTEROPERABILITY
  # ============================================================================
  
  - id: VEND-VIF-011
    category: interoperability
    requirement: "Support mandatory credential formats (ISO 18013-5 and W3C VC)"
    explanation: |
      The VIF must be capable of verifying attestations in both mandated formats: 
      ISO/IEC 18013-5:2021 (mDoc) and W3C Verifiable Credentials Data Model 1.1. 
      This ensures interoperability across the EUDIW ecosystem.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 8"
      paragraph: ""
    annexReference: |
      Annex II of 2024/2979:
      - ISO/IEC.18013-5:2021
      - 'Verifiable Credentials Data Model 1.1', W3C Recommendation
    applicability:
      - vif
    linkedRCA:
      - RP-TEC-001
    deadline: "2027-11-21"
    criticality: critical
  
  - id: VEND-VIF-012
    category: interoperability
    requirement: "Support selective disclosure in both credential formats"
    explanation: |
      The VIF's verification implementation must correctly handle selectively 
      disclosed attributes in both mDoc and VC formats. Verification must 
      succeed even when only a subset of attributes is presented.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 5"
      paragraph: "4"
    applicability:
      - vif
    linkedRCA:
      - RP-TEC-003
    deadline: "2027-11-21"
    criticality: high
  
  # ============================================================================
  # CERTIFICATION
  # ============================================================================
  
  - id: VEND-VIF-013
    category: certification
    requirement: "Consider certification for cryptographic components"
    explanation: |
      Depending on the assurance level required by the RP, the VIF may need to 
      demonstrate that its cryptographic implementations meet recognized standards 
      (e.g., FIPS 140-2/3, Common Criteria). This is especially relevant for 
      high-assurance use cases.
    legalBasis:
      regulation: "2019/881"
      article: "Article 47"
      paragraph: ""
    applicability:
      - vif
    deadline: "2027-11-21"
    criticality: medium
    notes: |
      This is a conditional requirement based on the RP's risk assessment and 
      the sensitivity of the use case. Not all VIFs will require certification.
