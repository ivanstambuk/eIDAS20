# RCA Requirements: Relying Party
# 
# Each requirement is defined ONCE and tagged with applicable:
# - roles: which roles this applies to
# - useCases: which use cases this applies to (or "all" for universal)
#
# The build script will filter and include requirements based on selected role + use cases.

# Schema version for future migrations
schemaVersion: 1

# Requirement categories for grouping in the UI
categories:
  registration:
    label: "Registration & Authorization"
    order: 1
    icon: "üìù"
  
  technical:
    label: "Technical Requirements"
    order: 2
    icon: "‚öôÔ∏è"
  
  authentication:
    label: "Authentication & Verification"
    order: 3
    icon: "üîê"
  
  data-protection:
    label: "Data Protection & Privacy"
    order: 4
    icon: "üõ°Ô∏è"
  
  security:
    label: "Security"
    order: 5
    icon: "üîí"
  
  operational:
    label: "Operational Requirements"
    order: 6
    icon: "üìã"

# Requirements list
requirements:

  # ============================================================================
  # REGISTRATION & AUTHORIZATION
  # ============================================================================

  - id: RP-REG-001
    category: registration
    requirement: "Register with competent supervisory authority before accepting EUDI Wallet"
    explanation: |
      Relying parties intending to rely on European Digital Identity Wallets must register with 
      the competent authority in the Member State where they are established. Registration is 
      a prerequisite for accepting wallet-based authentication.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "1"
    legalText: |
      Relying parties intending to rely on European Digital Identity Wallets shall register 
      with the competent supervisory body in the Member State where they are established.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all  # Applies to ALL use cases for RPs

  - id: RP-REG-002
    category: registration
    requirement: "Declare intended service categories and requested attributes"
    explanation: |
      During registration, relying parties must specify the services for which they will use 
      the wallet and which attributes (PID fields, EAAs) they intend to request. This enables 
      data minimization oversight.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "2"
    legalText: |
      The registration shall include information on the identity of the relying party, 
      the services for which the European Digital Identity Wallet will be used, and the 
      person identification data or electronic attestations of attributes that the relying 
      party intends to request.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-003
    category: registration
    requirement: "Obtain and maintain Relying Party Access Certificate"
    explanation: |
      After successful registration, relying parties receive an access certificate that must 
      be presented to wallet units. The certificate authenticates the RP and contains the 
      registered attribute scope.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "3"
    legalText: |
      Upon registration, the competent supervisory body shall issue a relying party access 
      certificate enabling the relying party to request person identification data and 
      electronic attestations of attributes from European Digital Identity Wallets.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-004
    category: registration
    requirement: "Update registration when use case or attribute scope changes"
    explanation: |
      If the relying party changes the services or requested attributes beyond the registered 
      scope, they must update their registration. Failure to maintain accurate registration 
      constitutes a compliance breach.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "4"
    legalText: |
      Relying parties shall notify the competent supervisory body of any significant changes 
      to the information provided during registration.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # TECHNICAL REQUIREMENTS
  # ============================================================================

  - id: RP-TECH-001
    category: technical
    requirement: "Validate Wallet Unit Attestation (WUA) before accepting credentials"
    explanation: |
      Before accepting any PID or EAA from a wallet, the relying party must validate the 
      Wallet Unit Attestation to ensure the wallet is genuine, uncompromised, and running 
      on secure hardware.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 5"
      paragraph: "1"
    legalText: |
      Before accepting person identification data or electronic attestations of attributes 
      from a wallet unit, a relying party shall validate the wallet unit attestation.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all
    technicalSpec: TS03

  - id: RP-TECH-002
    category: technical
    requirement: "Verify wallet unit belongs to a certified wallet solution"
    explanation: |
      The WUA validation must confirm that the wallet unit belongs to a wallet solution 
      that has been certified and is listed on the relevant Trusted List.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 5"
      paragraph: "2"
    legalText: |
      The relying party shall verify that the wallet unit belongs to a wallet solution that 
      has been certified in accordance with Implementing Regulation (EU) 2024/2981 and is 
      included in the relevant trusted list.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-003
    category: technical
    requirement: "Support at least one of the mandated credential formats"
    explanation: |
      Relying parties must support at least one of the credential formats specified in the 
      implementing acts: SD-JWT VC for online scenarios or ISO 18013-5 (mDoc) for proximity 
      scenarios.
    legalBasis:
      regulation: "2024/2977"
      article: "Article 6"
      paragraph: "1"
    legalText: |
      Electronic attestations of attributes issued to wallet units shall comply with at 
      least one of the standards listed in Annex I.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-004
    category: technical
    requirement: "Implement OpenID4VP protocol for credential requests"
    explanation: |
      For online remote presentation scenarios, relying parties shall implement the OpenID 
      for Verifiable Presentations (OpenID4VP) protocol as specified in the technical 
      specifications.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 8"
      paragraph: "1"
    legalText: |
      For remote online presentation of person identification data and electronic 
      attestations of attributes, relying parties shall implement the protocols specified 
      in Annex III.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pid-online
      - payment-auth
      - open-bank-account
      - age-verification
      - esignature
      - pseudonym

  - id: RP-TECH-005
    category: technical
    requirement: "Implement ISO 18013-5 for proximity/in-person scenarios"
    explanation: |
      For in-person (proximity) presentation scenarios, relying parties shall implement 
      the ISO 18013-5 standard for device engagement and data retrieval.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 8"
      paragraph: "2"
    legalText: |
      For proximity presentation of person identification data and electronic attestations 
      of attributes, relying parties shall implement the protocols specified in Annex IV.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - proximity-id
      - mdl
      - age-verification

  - id: RP-TECH-006
    category: technical
    requirement: "Use ES256 algorithm for signature verification"
    explanation: |
      Credential signatures shall be verified using the ES256 (ECDSA with P-256 and SHA-256) 
      algorithm as the mandatory baseline. HSMs must support this curve.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 9"
      paragraph: "1"
    legalText: |
      The cryptographic algorithms and key types used for the issuance and verification of 
      person identification data and electronic attestations of attributes shall comply 
      with the specifications in Annex V.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # AUTHENTICATION & VERIFICATION
  # ============================================================================

  - id: RP-AUTH-001
    category: authentication
    requirement: "Verify cryptographic holder binding"
    explanation: |
      Relying parties must verify that the wallet presenting credentials possesses the 
      private key bound to those credentials. This prevents replay attacks.
    legalBasis:
      regulation: "2024/2977"
      article: "Article 7"
      paragraph: "1"
    legalText: |
      Relying parties shall verify that the wallet unit presenting person identification 
      data or electronic attestations of attributes possesses the private key associated 
      with the public key bound to those credentials.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-AUTH-002
    category: authentication
    requirement: "Verify credential issuer signature against Trusted Lists"
    explanation: |
      The digital signature on credentials must be verified against the issuer's public 
      key, retrieved from the applicable Trusted List.
    legalBasis:
      regulation: "2024/2977"
      article: "Article 7"
      paragraph: "2"
    legalText: |
      Relying parties shall verify the digital signature of person identification data 
      and electronic attestations of attributes against the issuer's public key obtained 
      from the relevant trusted list.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-AUTH-003
    category: authentication
    requirement: "Check credential revocation status"
    explanation: |
      Before accepting credentials, relying parties must check their revocation status 
      using the privacy-preserving mechanisms specified (e.g., Bitstring Status Lists).
    legalBasis:
      regulation: "2024/2977"
      article: "Article 8"
      paragraph: "1"
    legalText: |
      Relying parties shall verify that the person identification data or electronic 
      attestations of attributes have not been revoked or suspended.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-AUTH-004
    category: authentication
    requirement: "Verify credential validity period"
    explanation: |
      Credentials have defined validity periods. Relying parties must reject expired 
      credentials.
    legalBasis:
      regulation: "2024/2977"
      article: "Article 8"
      paragraph: "2"
    legalText: |
      Relying parties shall verify that the person identification data or electronic 
      attestations of attributes are within their validity period.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # PSD2 SCA SPECIFIC (payment-auth, open-bank-account)
  # ============================================================================

  - id: RP-SCA-001
    category: authentication
    requirement: "Support wallet-based Strong Customer Authentication (SCA)"
    explanation: |
      Payment service providers must accept the EUDI Wallet as a means of performing 
      Strong Customer Authentication for payment transactions and account access.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "1"
    relatedRegulation:
      regulation: "PSD2"
      article: "Article 97"
    legalText: |
      Private relying parties providing services referred to in Article 97 of Directive 
      (EU) 2015/2366 shall accept European Digital Identity Wallets for strong customer 
      authentication.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
      - open-bank-account
    technicalSpec: TS12

  - id: RP-SCA-002
    category: authentication
    requirement: "Implement Dynamic Linking for payment transactions"
    explanation: |
      For remote payment transactions, the authentication code must be dynamically 
      linked to a specific amount and payee. The wallet must display these details 
      before the user signs.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "2"
    relatedRegulation:
      regulation: "PSD2"
      article: "Article 97(2)"
    legalText: |
      For remote payment transactions, the authentication shall include elements which 
      dynamically link the transaction to a specific amount and a specific payee.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
    technicalSpec: TS12

  - id: RP-SCA-003
    category: authentication
    requirement: "Transmit Transaction Object securely to wallet"
    explanation: |
      The bank must structure payment details into a Transaction Object and transmit 
      it securely to the wallet. The wallet's signature must cover the hash of this object.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "3"
    legalText: |
      The authentication code generated shall be specific to the amount of the transaction 
      and the payee agreed to by the payer.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
    technicalSpec: TS12

  - id: RP-SCA-004
    category: authentication
    requirement: "Accept SCA Attestation from wallet"
    explanation: |
      Relying parties (PSPs) shall accept SCA Attestations issued by authorized 
      providers, which associate a Wallet Unit with a specific payer and account.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "4"
    legalText: |
      Payment service providers shall accept electronic attestations of attributes 
      attesting to the association between a wallet unit and a payment account or 
      payment instrument.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
    technicalSpec: TS12

  # ============================================================================
  # DATA PROTECTION & PRIVACY
  # ============================================================================

  - id: RP-DP-001
    category: data-protection
    requirement: "Request only necessary and proportionate attributes"
    explanation: |
      Relying parties shall only request attributes that are necessary and proportionate 
      for the specific service. Over-requesting data violates data minimization principles.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "1"
    legalText: |
      Relying parties shall request from users only those person identification data and 
      electronic attestations of attributes that are necessary and proportionate for the 
      intended service.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-002
    category: data-protection
    requirement: "Support selective disclosure of attributes"
    explanation: |
      Systems must be capable of processing selectively disclosed attributes. Users 
      should not be forced to reveal more data than necessary (e.g., verifying "over 18" 
      without revealing exact birth date).
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "4(e)"
    legalText: |
      The European Digital Identity Wallet shall enable the user to selectively disclose 
      to relying parties person identification data and electronic attestations of 
      attributes.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-003
    category: data-protection
    requirement: "Display registered identity and intended use to wallet user"
    explanation: |
      When requesting credentials, the relying party must display their verified identity 
      and the purpose for which data is being requested, enabling informed user consent.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "2"
    legalText: |
      Relying parties shall provide, to users and to the European Digital Identity Wallet, 
      information about their identity and the purpose for which the person identification 
      data or electronic attestations of attributes are requested.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-004
    category: data-protection
    requirement: "Do not track wallet usage across services (unlinkability)"
    explanation: |
      Relying parties must not implement mechanisms to track or correlate wallet usage 
      across different transactions or services, preserving user privacy.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "4(f)"
    legalText: |
      The European Digital Identity Wallet shall be designed and implemented in such a 
      way that it prevents the tracking of users across different relying parties unless 
      the user has given explicit consent.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-005
    category: data-protection
    requirement: "Process data in accordance with GDPR"
    explanation: |
      All personal data received from wallets must be processed in full compliance 
      with GDPR, including lawful basis, storage limitation, and data subject rights.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "3"
    relatedRegulation:
      regulation: "GDPR"
      article: "Article 5"
    legalText: |
      The processing of personal data by relying parties shall comply with Regulation 
      (EU) 2016/679.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # SECURITY
  # ============================================================================

  - id: RP-SEC-001
    category: security
    requirement: "Implement replay attack prevention"
    explanation: |
      Authentication requests must include a cryptographic nonce. The response signature 
      must cover this nonce to prevent replay of captured authentication tokens.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 10"
      paragraph: "1"
    legalText: |
      Relying parties shall implement measures to prevent the replay of person 
      identification data or electronic attestations of attributes.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-SEC-002
    category: security
    requirement: "Secure transport using TLS 1.3 or equivalent"
    explanation: |
      All communications with wallet units must be encrypted using TLS 1.3 or 
      equivalent secure transport protocols.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 10"
      paragraph: "2"
    legalText: |
      Communications between relying parties and wallet units shall be protected by 
      appropriate cryptographic means.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-SEC-003
    category: security
    requirement: "Log Wallet Unit Attestations for audit trail"
    explanation: |
      Relying parties should retain WUA information for each transaction to build 
      a defensible audit trail in case of fraud disputes.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 11"
      paragraph: "1"
    legalText: |
      Relying parties shall maintain records of the wallet unit attestations received 
      in accordance with applicable record-keeping requirements.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-SEC-004
    category: security
    requirement: "Block transactions from compromised wallet units"
    explanation: |
      If WUA indicates a compromised security state (e.g., rooted device, software-only 
      keys for high-assurance use cases), the transaction must be blocked.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 5"
      paragraph: "3"
    legalText: |
      Relying parties shall reject person identification data or electronic attestations 
      of attributes from wallet units for which the wallet unit attestation indicates a 
      security state that is incompatible with the assurance level required for the service.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # OPERATIONAL
  # ============================================================================

  - id: RP-OPS-001
    category: operational
    requirement: "Maintain fallback authentication mechanisms"
    explanation: |
      Relying parties should maintain alternative authentication methods in case of 
      EUDI Wallet ecosystem outages (e.g., national infrastructure failures).
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "5"
    legalText: |
      The acceptance requirement shall not prevent relying parties from maintaining 
      alternative means of online identification.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-OPS-002
    category: operational
    requirement: "Report security incidents to supervisory authority"
    explanation: |
      Severe incidents affecting the reliability of EUDI Wallet interfaces must be 
      reported to the supervisory authority within mandated timeframes.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5d"
      paragraph: "1"
    legalText: |
      Relying parties shall notify the competent supervisory body of any breach or 
      compromise of the security of their systems that affects the reliability of the 
      acceptance of European Digital Identity Wallets.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-OPS-003
    category: operational
    requirement: "Provide user support for wallet-based authentication"
    explanation: |
      Users must have access to support channels for issues related to wallet-based 
      authentication at the relying party.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "4"
    legalText: |
      Relying parties shall ensure that appropriate support is available to users for 
      the use of European Digital Identity Wallets in relation to their services.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all
