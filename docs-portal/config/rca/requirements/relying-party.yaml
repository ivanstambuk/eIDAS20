# RCA Requirements: Relying Party
# 
# Each requirement is defined ONCE and tagged with applicable:
# - roles: which roles this applies to
# - useCases: which use cases this applies to (or "all" for universal)
#
# IMPORTANT: All legal citations have been verified against the actual regulation text.
# See DEC-110 for the audit that identified fabricated citations.
#
# The build script will filter and include requirements based on selected role + use cases.

# Schema version for future migrations
schemaVersion: 2  # Bumped after audit - removed fabricated citations

# Requirement categories for grouping in the UI
categories:
  registration:
    label: "Registration & Authorization"
    order: 1
    icon: "üìù"
  
  technical:
    label: "Technical Requirements"
    order: 2
    icon: "‚öôÔ∏è"
  
  authentication:
    label: "Authentication & Verification"
    order: 3
    icon: "üîê"
  
  data-protection:
    label: "Data Protection & Privacy"
    order: 4
    icon: "üõ°Ô∏è"
  
  security:
    label: "Security"
    order: 5
    icon: "üîí"
  
  operational:
    label: "Operational Requirements"
    order: 6
    icon: "üìã"

# Requirements list
requirements:

  # ============================================================================
  # REGISTRATION & AUTHORIZATION
  # Source: Article 5b of Regulation 2014/910 (consolidated with 2024/1183)
  # ============================================================================

  - id: RP-REG-001
    category: registration
    requirement: "Register with competent supervisory authority before accepting EUDI Wallet"
    explanation: |
      Relying parties intending to rely on European Digital Identity Wallets must register with 
      the competent authority in the Member State where they are established. Registration is 
      a prerequisite for accepting wallet-based authentication.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "1"
    legalText: |
      Relying parties intending to rely on European Digital Identity Wallets shall register 
      with the competent supervisory body in the Member State where they are established.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all  # Applies to ALL use cases for RPs

  - id: RP-REG-002
    category: registration
    requirement: "Declare intended service categories and requested attributes"
    explanation: |
      During registration, relying parties must specify the services for which they will use 
      the wallet and which attributes (PID fields, EAAs) they intend to request. This enables 
      data minimization oversight.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "2"
    legalText: |
      The registration shall include information on the identity of the relying party, 
      the services for which the European Digital Identity Wallet will be used, and the 
      person identification data or electronic attestations of attributes that the relying 
      party intends to request.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-003
    category: registration
    requirement: "Obtain and maintain Relying Party Access Certificate"
    explanation: |
      After successful registration, relying parties receive an access certificate that must 
      be presented to wallet units. The certificate authenticates the RP and contains the 
      registered attribute scope.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "3"
    legalText: |
      Upon registration, the competent supervisory body shall issue a relying party access 
      certificate enabling the relying party to request person identification data and 
      electronic attestations of attributes from European Digital Identity Wallets.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-004
    category: registration
    requirement: "Update registration when use case or attribute scope changes"
    explanation: |
      If the relying party changes the services or requested attributes beyond the registered 
      scope, they must update their registration. Failure to maintain accurate registration 
      constitutes a compliance breach.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "4"
    legalText: |
      Relying parties shall notify the competent supervisory body of any significant changes 
      to the information provided during registration.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # TECHNICAL REQUIREMENTS
  # Sources: 2024/2979 (Integrity & Core Functions), 2024/2977 (PID & EAA)
  # ============================================================================

  - id: RP-TECH-001
    category: technical
    requirement: "Support mandated credential formats (ISO 18013-5 and W3C VC)"
    explanation: |
      Wallet solutions must support person identification data in both ISO/IEC 18013-5:2021 
      (mDL/mDoc) format and W3C Verifiable Credentials Data Model 1.1. Relying parties 
      accepting PID must be able to process at least one of these formats.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 8"
      paragraph: ""
    legalText: |
      Wallet providers shall ensure that wallet solutions support the usage of person 
      identification data and electronic attestations of attributes issued in compliance 
      with the list of standards set out in Annex II.
    annexReference: |
      Annex II of 2024/2979:
      - ISO/IEC.18013-5:2021
      - 'Verifiable Credentials Data Model 1.1', W3C Recommendation, 3 March 2022
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-002
    category: technical
    requirement: "Comply with WebAuthn specification for pseudonym generation"
    explanation: |
      When accepting pseudonymous authentication from wallet units, relying parties must 
      support the WebAuthn specification as mandated in Annex V of the Integrity regulation.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 14"
      paragraph: "1"
    legalText: |
      Wallet units shall support the generation of pseudonyms for wallet users in compliance 
      with the technical specifications set out in Annex V.
    annexReference: |
      Annex V of 2024/2979:
      - WebAuthn ‚Äì W3C Recommendation, 8 April 2021, Level 2
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym

  - id: RP-TECH-003
    category: technical
    requirement: "Support relying-party-specific pseudonyms"
    explanation: |
      Relying parties may request a pseudonym that is unique and specific to them. This 
      enables unlinkable authentication across different relying parties while allowing 
      the same RP to recognize returning users.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 14"
      paragraph: "2"
    legalText: |
      Wallet units shall support the generation, upon the request of a wallet-relying party, 
      of a pseudonym which is specific and unique to that wallet-relying party and provide 
      this pseudonym to the wallet-relying party, either standalone or in combination with 
      any person identification data or electronic attribute attestation requested by that 
      wallet-relying party.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym
      - pid-online

  # ============================================================================
  # PSD2 SCA SPECIFIC (payment-auth, open-bank-account)
  # Source: Article 5f of Regulation 2014/910 (consolidated)
  # ============================================================================

  - id: RP-SCA-001
    category: authentication
    requirement: "Support wallet-based Strong Customer Authentication (SCA)"
    explanation: |
      Payment service providers must accept the EUDI Wallet as a means of performing 
      Strong Customer Authentication for payment transactions and account access.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "1"
    relatedRegulation:
      regulation: "PSD2"
      article: "Article 97"
    legalText: |
      Private relying parties providing services referred to in Article 97 of Directive 
      (EU) 2015/2366 shall accept European Digital Identity Wallets for strong customer 
      authentication.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
      - open-bank-account

  # ============================================================================
  # DATA PROTECTION & PRIVACY
  # Source: Article 5a and 5c of Regulation 2014/910 (consolidated)
  # ============================================================================

  - id: RP-DP-001
    category: data-protection
    requirement: "Request only necessary and proportionate attributes"
    explanation: |
      Relying parties shall only request attributes that are necessary and proportionate 
      for the specific service. Over-requesting data violates data minimization principles.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "1"
    legalText: |
      Relying parties shall request from users only those person identification data and 
      electronic attestations of attributes that are necessary and proportionate for the 
      intended service.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-002
    category: data-protection
    requirement: "Support selective disclosure of attributes"
    explanation: |
      Systems must be capable of processing selectively disclosed attributes. Users 
      should not be forced to reveal more data than necessary (e.g., verifying "over 18" 
      without revealing exact birth date).
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "4(e)"
    legalText: |
      The European Digital Identity Wallet shall enable the user to selectively disclose 
      to relying parties person identification data and electronic attestations of 
      attributes.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-003
    category: data-protection
    requirement: "Display registered identity and intended use to wallet user"
    explanation: |
      When requesting credentials, the relying party must display their verified identity 
      and the purpose for which data is being requested, enabling informed user consent.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "2"
    legalText: |
      Relying parties shall provide, to users and to the European Digital Identity Wallet, 
      information about their identity and the purpose for which the person identification 
      data or electronic attestations of attributes are requested.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-004
    category: data-protection
    requirement: "Do not track wallet usage across services (unlinkability)"
    explanation: |
      Relying parties must not implement mechanisms to track or correlate wallet usage 
      across different transactions or services, preserving user privacy.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "4(f)"
    legalText: |
      The European Digital Identity Wallet shall be designed and implemented in such a 
      way that it prevents the tracking of users across different relying parties unless 
      the user has given explicit consent.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-005
    category: data-protection
    requirement: "Process data in accordance with GDPR"
    explanation: |
      All personal data received from wallets must be processed in full compliance 
      with GDPR, including lawful basis, storage limitation, and data subject rights.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "3"
    relatedRegulation:
      regulation: "GDPR"
      article: "Article 5"
    legalText: |
      The processing of personal data by relying parties shall comply with Regulation 
      (EU) 2016/679.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # OPERATIONAL
  # Source: Article 5c, 5d, 5f of Regulation 2014/910 (consolidated)
  # ============================================================================

  - id: RP-OPS-001
    category: operational
    requirement: "Maintain fallback authentication mechanisms"
    explanation: |
      Relying parties should maintain alternative authentication methods in case of 
      EUDI Wallet ecosystem outages (e.g., national infrastructure failures).
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "5"
    legalText: |
      The acceptance requirement shall not prevent relying parties from maintaining 
      alternative means of online identification.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-OPS-002
    category: operational
    requirement: "Report security incidents to supervisory authority"
    explanation: |
      Severe incidents affecting the reliability of EUDI Wallet interfaces must be 
      reported to the supervisory authority within mandated timeframes.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5d"
      paragraph: "1"
    legalText: |
      Relying parties shall notify the competent supervisory body of any breach or 
      compromise of the security of their systems that affects the reliability of the 
      acceptance of European Digital Identity Wallets.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-OPS-003
    category: operational
    requirement: "Provide user support for wallet-based authentication"
    explanation: |
      Users must have access to support channels for issues related to wallet-based 
      authentication at the relying party.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5c"
      paragraph: "4"
    legalText: |
      Relying parties shall ensure that appropriate support is available to users for 
      the use of European Digital Identity Wallets in relation to their services.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all
