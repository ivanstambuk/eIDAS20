# RCA Requirements: Relying Party
# 
# Systematic article-by-article review of all RP-applicable requirements from:
# - Regulation (EU) 2014/910 (consolidated with 2024/1183) - Articles 5, 5a-5f
# - Implementing Regulation (EU) 2024/2979 - Integrity & Core Functions
# - Implementing Regulation (EU) 2024/2982 - Protocols & Interfaces  
# - Implementing Regulation (EU) 2024/2977 - PID and EAA
#
# Each requirement is defined ONCE and tagged with applicable:
# - roles: which roles this applies to
# - useCases: which use cases this applies to (or "all" for universal)
#
# AUDIT: 2026-01-19 - All citations verified against actual regulation text
# Schema version 3 - Complete article-by-article review

schemaVersion: 3

# Requirement categories for grouping in the UI
categories:
  registration:
    label: "Registration & Authorization"
    order: 1
    icon: "üìù"
  
  technical:
    label: "Technical Requirements"
    order: 2
    icon: "‚öôÔ∏è"
  
  authentication:
    label: "Authentication & Verification"
    order: 3
    icon: "üîê"
  
  data-protection:
    label: "Data Protection & Privacy"
    order: 4
    icon: "üõ°Ô∏è"
  
  security:
    label: "Security"
    order: 5
    icon: "üîí"
  
  operational:
    label: "Operational Requirements"
    order: 6
    icon: "üìã"

# Requirements list
requirements:

  # ============================================================================
  # REGISTRATION & AUTHORIZATION
  # Source: Article 5b of Regulation (EU) 910/2014 (consolidated)
  # ============================================================================

  - id: RP-REG-001
    category: registration
    requirement: "Register with competent supervisory authority before accepting EUDI Wallet"
    explanation: |
      Relying parties intending to rely on European Digital Identity Wallets must register with 
      the competent authority in the Member State where they are established. Registration is 
      a prerequisite for accepting wallet-based authentication.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "1"
    legalText: |
      Where a relying party intends to rely upon European Digital Identity Wallets for the 
      provision of public or private services by means of digital interaction, the relying 
      party shall register in the Member State where it is established.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-002
    category: registration
    requirement: "Provide registration information including identity and intended data requests"
    explanation: |
      During registration, relying parties must provide specific information including their 
      identity, contact details, and importantly - the data they intend to request from users.
      This enables oversight of data minimization compliance.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "2"
    legalText: |
      The registration process shall be cost-effective and proportionate-to-risk. The relying 
      party shall provide at least: (a) the information necessary to authenticate to European 
      Digital Identity Wallets, which as a minimum includes: (i) the Member State in which the 
      relying party is established; and (ii) the name of the relying party and, where applicable, 
      its registration number as stated in an official record together with identification data 
      of that official record; (b) the contact details of the relying party; (c) the intended 
      use of European Digital Identity Wallets, including an indication of the data to be 
      requested by the relying party from users.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-003
    category: registration
    requirement: "Request only data indicated during registration"
    explanation: |
      Relying parties are strictly limited to requesting only the data they declared during 
      registration. Requesting additional data beyond the registered scope is prohibited.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "3"
    legalText: |
      Relying parties shall not request users to provide any data other than that indicated 
      pursuant to paragraph 2, point (c).
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-004
    category: registration
    requirement: "Notify changes to registration information without delay"
    explanation: |
      If the relying party's registration information changes (e.g., new data fields requested, 
      contact details updated), they must promptly notify the Member State.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "6"
    legalText: |
      Relying parties registered in accordance with this Article shall inform Member States 
      without delay about any changes to the information provided in the registration 
      pursuant to paragraph 2.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-005
    category: registration
    requirement: "Identify yourself to wallet users when requesting data"
    explanation: |
      When relying parties request data from wallet users, they must clearly identify 
      themselves. The wallet displays the RP's identity information from their access 
      certificate to enable user trust decisions.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "8"
    legalText: |
      Where relying parties intend to rely upon European Digital Identity Wallets, they 
      shall identify themselves to the user.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-REG-006
    category: registration
    requirement: "Accept pseudonymous authentication where legal identity is not required"
    explanation: |
      When a user's legal identity is not required by law, relying parties must accept 
      pseudonymous authentication. Users cannot be forced to reveal their real identity 
      when pseudonymous access is sufficient.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "9"
    legalText: |
      Relying parties shall be responsible for carrying out the procedure for authenticating 
      and validating person identification data and electronic attestation of attributes 
      requested from European Digital Identity Wallets. Relying parties shall not refuse the 
      use of pseudonyms, where the identification of the user is not required by Union or 
      national law.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym
      - age-verification

  # ============================================================================
  # TECHNICAL REQUIREMENTS  
  # Sources: 2024/2979 (Integrity), 2024/2982 (Protocols), 2014/910 Art 5a
  # ============================================================================

  - id: RP-TECH-001
    category: technical
    requirement: "Support mandated credential formats (ISO 18013-5 and W3C VC)"
    explanation: |
      Wallet solutions must support person identification data in both ISO/IEC 18013-5:2021 
      (mDL/mDoc) format and W3C Verifiable Credentials Data Model 1.1. Relying parties 
      accepting PID must be able to process at least one of these formats.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 8"
      paragraph: ""
    legalText: |
      Wallet providers shall ensure that wallet solutions support the usage of person 
      identification data and electronic attestations of attributes issued in compliance 
      with the list of standards set out in Annex II.
    annexReference: |
      Annex II of 2024/2979:
      - ISO/IEC.18013-5:2021
      - 'Verifiable Credentials Data Model 1.1', W3C Recommendation, 3 March 2022
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-002
    category: technical
    requirement: "Implement presentation protocols (ISO 18013-5, ISO 18013-7)"
    explanation: |
      For remote and proximity presentation of credentials, relying parties must implement 
      the standardized protocols specified in the Annex to Regulation 2024/2982.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 5"
      paragraph: "1-2"
    legalText: |
      Wallet providers shall ensure that wallet solutions support protocols and interfaces 
      for the presentation of attributes to wallet-relying parties, remotely, and where 
      appropriate in proximity, in accordance with the standards set out in the Annex.
    annexReference: |
      Annex to 2024/2982:
      - ISO/IEC 18013-5:2021
      - ISO/IEC TS 18013-7:2024
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-003
    category: technical
    requirement: "Support selective disclosure of attributes"
    explanation: |
      The technical implementation must support selective disclosure, allowing users to 
      share only specific attributes (e.g., "over 18") rather than full credentials.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 5"
      paragraph: "4"
    legalText: |
      Wallet providers shall ensure that wallet solutions support the selective disclosure 
      of attributes of personal identification data and of electronic attestations of 
      attributes.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-004
    category: technical
    requirement: "Comply with WebAuthn specification for pseudonym generation"
    explanation: |
      When accepting pseudonymous authentication from wallet units, relying parties must 
      support the WebAuthn specification as mandated in Annex V of the Integrity regulation.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 14"
      paragraph: "1"
    legalText: |
      Wallet units shall support the generation of pseudonyms for wallet users in compliance 
      with the technical specifications set out in Annex V.
    annexReference: |
      Annex V of 2024/2979:
      - WebAuthn ‚Äì W3C Recommendation, 8 April 2021, Level 2
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym

  - id: RP-TECH-005
    category: technical
    requirement: "Support relying-party-specific pseudonyms"
    explanation: |
      Relying parties may request a pseudonym that is unique and specific to them. This 
      enables unlinkable authentication across different relying parties while allowing 
      the same RP to recognize returning users.
    legalBasis:
      regulation: "2024/2979"
      article: "Article 14"
      paragraph: "2"
    legalText: |
      Wallet units shall support the generation, upon the request of a wallet-relying party, 
      of a pseudonym which is specific and unique to that wallet-relying party and provide 
      this pseudonym to the wallet-relying party, either standalone or in combination with 
      any person identification data or electronic attribute attestation requested by that 
      wallet-relying party.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym
      - pid-online

  - id: RP-TECH-006
    category: technical
    requirement: "Verify proof of possession of private keys"
    explanation: |
      When receiving credentials, relying parties must verify that the wallet possesses 
      the private key corresponding to the public key used in the cryptographic binding.
      This prevents replay attacks and credential theft.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 5"
      paragraph: "3"
    legalText: |
      Wallet providers shall ensure that wallet units support proving the possession of 
      private keys corresponding to public keys used in cryptographic bindings.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-007
    category: technical
    requirement: "Use valid Wallet-Relying Party Access Certificate"
    explanation: |
      Relying parties must use a valid wallet-relying party access certificate when 
      interacting with wallet units. This certificate authenticates the RP to the wallet.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 3"
      paragraph: "1"
    legalText: |
      Regarding the protocols and interfaces referred to in Articles 4 and 5, wallet 
      providers shall ensure that wallet units authenticate and validate the wallet-relying 
      party access certificates where interacting with wallet-relying parties.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-TECH-008
    category: technical
    requirement: "Support data erasure request protocol"
    explanation: |
      Relying parties must implement the protocol allowing wallet users to request erasure 
      of personal data that was shared through the wallet, supporting GDPR Article 17 rights.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 6"
      paragraph: "1"
    legalText: |
      Wallet providers shall ensure that wallet units support protocols and interfaces 
      allowing wallet users to request from wallet-relying parties, with whom they have 
      interacted through those wallet units, the erasure of their personal data provided 
      through those wallet units, in accordance with Article 17 of Regulation (EU) 2016/679.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # CROSS-BORDER ACCEPTANCE REQUIREMENTS
  # Source: Article 5f of Regulation (EU) 910/2014 (consolidated)
  # ============================================================================

  - id: RP-ACCEPT-001
    category: operational
    requirement: "Public sector: Accept EUDI Wallet for online services requiring e-ID"
    explanation: |
      When a public sector body requires electronic identification to access an online 
      service, they must also accept EUDI Wallets provided in accordance with the regulation.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "1"
    legalText: |
      Where Member States require electronic identification and authentication to access 
      an online service provided by a public sector body, they shall also accept European 
      Digital Identity Wallets that are provided in accordance with this Regulation.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pid-online
      - esignature

  - id: RP-ACCEPT-002
    category: operational
    requirement: "Private sector: Accept EUDI Wallet where strong authentication is mandated"
    explanation: |
      Private relying parties (except micro/small enterprises) must accept EUDI Wallets 
      when strong user authentication is required by law or contract in specified sectors.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "2"
    legalText: |
      Where private relying parties that provide services, with the exception of 
      microenterprises and small enterprises [...], are required by Union or national law 
      to use strong user authentication for online identification or where strong user 
      authentication for online identification is required by contractual obligation, 
      including in the areas of transport, energy, banking, financial services, social 
      security, health, drinking water, postal services, digital infrastructure, education 
      or telecommunications, those private relying parties shall [...] also accept European 
      Digital Identity Wallets that are provided in accordance with this Regulation.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
      - open-bank-account
      - pid-online

  - id: RP-ACCEPT-003
    category: operational
    requirement: "Very large online platforms: Accept EUDI Wallet for user authentication"
    explanation: |
      Providers of very large online platforms (as defined in DSA Article 33) must accept 
      EUDI Wallets for user authentication upon voluntary user request.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "3"
    legalText: |
      Where providers of very large online platforms as referred to in Article 33 of 
      Regulation (EU) 2022/2065 [...] require user authentication for access to online 
      services, they shall also accept and facilitate the use of European Digital Identity 
      Wallets that are provided in accordance with this Regulation for user authentication 
      only upon the voluntary request of the user and in respect of the minimum data 
      necessary for the specific online service for which authentication is requested.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pid-online

  # ============================================================================
  # PSD2 SCA SPECIFIC (payment-auth, open-bank-account)  
  # Source: Article 5f + PSD2 Directive
  # ============================================================================

  - id: RP-SCA-001
    category: authentication
    requirement: "Support wallet-based Strong Customer Authentication (SCA)"
    explanation: |
      Payment service providers must accept the EUDI Wallet as a means of performing 
      Strong Customer Authentication for payment transactions and account access.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5f"
      paragraph: "2"
    relatedRegulation:
      regulation: "PSD2"
      article: "Article 97"
    legalText: |
      Where private relying parties that provide services [...] are required by Union or 
      national law to use strong user authentication for online identification [...] 
      including in the areas of [...] banking, financial services [...] those private 
      relying parties shall [...] also accept European Digital Identity Wallets.
    deadline: "2027-12-21"
    roles:
      - relying_party
    useCases:
      - payment-auth
      - open-bank-account

  # ============================================================================
  # DATA PROTECTION & PRIVACY
  # Source: Articles 5a, 5c, and 5 of Regulation (EU) 910/2014 (consolidated)
  # ============================================================================

  - id: RP-DP-001
    category: data-protection
    requirement: "Request only necessary and proportionate attributes"
    explanation: |
      Relying parties shall only request attributes that are necessary and proportionate 
      for the specific service. Over-requesting data violates data minimization principles.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5b"
      paragraph: "3"
    legalText: |
      Relying parties shall not request users to provide any data other than that indicated 
      pursuant to paragraph 2, point (c).
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-002
    category: data-protection
    requirement: "Support selective disclosure of attributes"
    explanation: |
      Systems must be capable of processing selectively disclosed attributes. Users 
      should not be forced to reveal more data than necessary (e.g., verifying "over 18" 
      without revealing exact birth date).
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "4(a)"
    legalText: |
      European Digital Identity Wallets shall enable the user, in a manner that is 
      user-friendly, transparent, and traceable by the user, to: (a) securely request, 
      obtain, select, combine, store, delete, share and present, under the sole control 
      of the user, person identification data and, where applicable, in combination with 
      electronic attestations of attributes, to authenticate to relying parties online 
      and, where appropriate, in offline mode, in order to access public and private 
      services, while ensuring that selective disclosure of data is possible.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-003
    category: data-protection
    requirement: "Do not track wallet usage across services (unlinkability)"
    explanation: |
      The technical framework must prevent tracking or correlation of wallet usage 
      across different services, unless the user explicitly consents.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "16(a)"
    legalText: |
      The technical framework of the European Digital Identity Wallet shall: (a) not allow 
      providers of electronic attestations of attributes or any other party, after the 
      issuance of the attestation of attributes, to obtain data that allows transactions 
      or user behaviour to be tracked, linked or correlated, or knowledge of transactions 
      or user behaviour to be otherwise obtained, unless explicitly authorised by the user.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-DP-004
    category: data-protection
    requirement: "Enable privacy preserving unlinkability for non-identified attestations"
    explanation: |
      When attestations don't require user identification, privacy-preserving techniques 
      must ensure unlinkability across different relying parties.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 3"
      paragraph: "10"
    legalText: |
      Wallet providers shall ensure that wallet units [...] enable privacy preserving 
      techniques which ensure unlinkability where the electronic attestations of 
      attributes do not require the identification of the wallet user, when presenting 
      attestations or person identification data across different wallet-relying parties.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - age-verification
      - pseudonym

  - id: RP-DP-005
    category: data-protection
    requirement: "Allow pseudonyms where legal identity is not required"
    explanation: |
      Users cannot be prohibited from using pseudonyms when there is no legal requirement 
      for identity verification.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5"
      paragraph: ""
    legalText: |
      Without prejudice to specific rules of Union or national law requiring users to 
      identify themselves or to the legal effect given to pseudonyms under national law, 
      the use of pseudonyms that are chosen by the user shall not be prohibited.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases:
      - pseudonym
      - age-verification

  - id: RP-DP-006
    category: data-protection
    requirement: "Process data in accordance with GDPR"
    explanation: |
      All personal data received from wallets must be processed in full compliance 
      with GDPR, including lawful basis, storage limitation, and data subject rights.
    legalBasis:
      regulation: "2014/910"
      article: "Article 2"
      paragraph: "4"
    relatedRegulation:
      regulation: "GDPR"
      article: "Article 5"
    legalText: |
      This Regulation is without prejudice to Regulation (EU) 2016/679 of the European 
      Parliament and of the Council.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  # ============================================================================
  # OPERATIONAL REQUIREMENTS
  # Source: Articles 5a, 5f of Regulation (EU) 910/2014 (consolidated)
  # ============================================================================

  - id: RP-OPS-001
    category: operational
    requirement: "Maintain alternative means of identification"
    explanation: |
      Relying parties may maintain alternative authentication methods. EUDI Wallet 
      acceptance requirements do not prevent offering other identification means.
    legalBasis:
      regulation: "2014/910"
      article: "Article 5a"
      paragraph: "15"
    legalText: |
      The use of European Digital Identity Wallets shall be voluntary. Access to public 
      and private services, access to the labour market and freedom to conduct business 
      shall not in any way be restricted or made disadvantageous to natural or legal 
      persons that do not use European Digital Identity Wallets. It shall remain possible 
      to access public and private services by other existing identification and 
      authentication means.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all

  - id: RP-OPS-002
    category: operational
    requirement: "Support reporting to data protection authorities"
    explanation: |
      Relying parties must be prepared to be reported to data protection authorities 
      through the wallet's reporting mechanism if users suspect unlawful data requests.
    legalBasis:
      regulation: "2024/2982"
      article: "Article 7"
      paragraph: "1"
    legalText: |
      Wallet providers shall ensure that wallet units allow wallet users to easily report 
      wallet-relying parties to supervisory authorities established under Article 51 of 
      Regulation (EU) 2016/679.
    deadline: "2027-11-21"
    roles:
      - relying_party
    useCases: all
